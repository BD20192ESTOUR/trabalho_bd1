CREATE TYPE TIPO_SEXO AS ENUM('M','F');

CREATE TABLE PESSOA(
	IDPESSOA SERIAL PRIMARY KEY,
	TIPO_USUARIO VARCHAR(50) NOT NULL,
	NOME VARCHAR(50) NOT NULL,
	DATA_NASCIMENTO DATE NOT NULL,
	SEXO TIPO_SEXO NOT NULL,
	EMAIL VARCHAR(50) UNIQUE,
	SENHA VARCHAR(30)
);

CREATE TABLE EMPREENDIMENTO(
	IDEMPREENDIMENTO SERIAL PRIMARY KEY,
	ID_BAIRRO INT,
	TIPO_USUARIO VARCHAR(50) NOT NULL,
	TIPO_EMPREENDIMENTO VARCHAR(30),
	NOME VARCHAR(100) NOT NULL,
	TIPO_AMBIENTE VARCHAR(50) NOT NULL,
	PUBLICO_ALVO VARCHAR(50),
	CNPJ VARCHAR(15),
	DESCRICAO VARCHAR(250),
	EMAIL VARCHAR(50) UNIQUE,
	SENHA VARCHAR(30),
	TIPO_LOGRADOURO VARCHAR(30),
	LOGRADOURO VARCHAR(100),
	NUMERO INT,
	CEP VARCHAR(15)	
);

CREATE TABLE HISTORICOVISITA(
	IDHISTORICOVISITA SERIAL PRIMARY KEY,
	ID_PESSOA INT NOT NULL,
	ID_EMPREENDIMENTO INT NOT NULL,
	DATA_VISITA DATE,
	HORA TIME
);

CREATE TABLE AVALIACAOLOCAL(
	IDAVALIACAOLOCAL SERIAL PRIMARY KEY,
	ID_PESSOA INT NOT NULL,
	ID_EMPREENDIMENTO INT NOT NULL,
	COMENTARIO VARCHAR(250),
	NOTA INT,
	DATA_AVALIACAO DATE,
	HORA TIME
);

CREATE TABLE EVENTO(
	IDEVENTO SERIAL PRIMARY KEY,
	DESCRICAO VARCHAR(250) NOT NULL,
	DATA_EVENTO DATE,
	HORA TIME,
	LINK VARCHAR(250)
);

CREATE TABLE EMPREENDIMENTO_EVENTO(
	EMPREENDIMENTO_EVENTO SERIAL PRIMARY KEY,
	ID_EMPREENDIMENTO INT NOT NULL,
	ID_EVENTO INT NOT NULL
);


CREATE TABLE ONIBUS(
	IDONIBUS SERIAL PRIMARY KEY,
	LINHA VARCHAR(15) NOT NULL,
	DESCRICAO VARCHAR(250),
	SISTEMA_TRANSPORTE VARCHAR(50)
);

CREATE TABLE EMPREENDIMENTO_ONIBUS(
	EMPREENDIMENTO_ONIBUS SERIAL PRIMARY KEY,
	ID_EMPREENDIMENTO INT NOT NULL,
	ID_ONIBUS INT NOT NULL
);

ALTER TABLE HISTORICOVISITA ADD CONSTRAINT ID_HISTORICOVISITA_PESSOA_FK
FOREIGN KEY (ID_PESSOA) REFERENCES PESSOA(IDPESSOA);

ALTER TABLE HISTORICOVISITA ADD CONSTRAINT ID_HISTORICOVISITA_EMPREENDIMENTO_FK
FOREIGN KEY (ID_EMPREENDIMENTO) REFERENCES EMPREENDIMENTO(IDEMPREENDIMENTO);

ALTER TABLE AVALIACAOLOCAL ADD CONSTRAINT ID_AVALIACAOLOCAL_PESSOA_FK
FOREIGN KEY (ID_PESSOA) REFERENCES PESSOA(IDPESSOA);

ALTER TABLE AVALIACAOLOCAL ADD CONSTRAINT ID_AVALIACAOLOCAL_EMPREENDIMENTO_FK
FOREIGN KEY (ID_EMPREENDIMENTO) REFERENCES EMPREENDIMENTO(IDEMPREENDIMENTO);

ALTER TABLE EMPREENDIMENTO_EVENTO ADD CONSTRAINT ID_EMPREENDIMENTO_EVENTO_EMPREENDIMENTO_FK
FOREIGN KEY (ID_EMPREENDIMENTO) REFERENCES EMPREENDIMENTO(IDEMPREENDIMENTO) MATCH FULL ON UPDATE CASCADE
ON DELETE CASCADE;

ALTER TABLE EMPREENDIMENTO_EVENTO ADD CONSTRAINT ID_EMPREENDIMENTO_EVENTO_EVENTO_FK
FOREIGN KEY (ID_EVENTO) REFERENCES EVENTO(IDEVENTO) MATCH FULL ON UPDATE CASCADE
ON DELETE CASCADE;

ALTER TABLE EMPREENDIMENTO_ONIBUS ADD CONSTRAINT ID_EMPREENDIMENTO_ONIBUS_EMPREENDIMENTO_FK
FOREIGN KEY (ID_EMPREENDIMENTO) REFERENCES EMPREENDIMENTO(IDEMPREENDIMENTO) MATCH FULL ON UPDATE CASCADE
ON DELETE CASCADE;

ALTER TABLE EMPREENDIMENTO_ONIBUS ADD CONSTRAINT ID_EMPREENDIMENTO_ONIBUS_ONIBUS_FK
FOREIGN KEY (ID_ONIBUS) REFERENCES ONIBUS(IDONIBUS) MATCH FULL ON UPDATE CASCADE
ON DELETE CASCADE;
